<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arco-Íris | Gestão Profissional de Reservas</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #8B0000;
            --primary-light: #B71C1C;
            --gold: #C5A028;
            --gold-gradient: linear-gradient(135deg, #D4AF37 0%, #C5A028 100%);
            --dark: #121212;
            --bg-body: #0f0f0f;
            --surface: #1e1e1e;
            --text-main: #e0e0e0;
            --text-dim: #a0a0a0;
            --success: #00c853;
            --warning: #ffd600;
            --danger: #ff5252;
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
        }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            background-image: radial-gradient(circle at 50% 0%, #2a0a0a 0%, #0f0f0f 70%);
            color: var(--text-main);
            min-height: 100vh;
        }

        /* Navigation Bar Superior */
        nav.top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 40px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
        }

        .nav-link {
            color: var(--gold);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
        }

        .nav-link:hover { color: #fff; }

        /* Header */
        header {
            padding: 40px 20px;
            text-align: center;
        }

        .logo-container {
            display: inline-flex;
            align-items: center;
            gap: 15px;
            background: var(--glass);
            padding: 15px 30px;
            border-radius: 50px;
            border: 1px solid var(--border);
            margin-bottom: 15px;
        }

        header h1 { 
            margin: 0; 
            font-size: 2.2rem; 
            letter-spacing: 4px; 
            font-weight: 800;
        }

        header p { color: var(--text-dim); margin: 5px 0 0; font-size: 0.9rem; letter-spacing: 2px; text-transform: uppercase; }

        /* Layout Grid */
        .container {
            max-width: 1300px;
            margin: 0 auto 50px;
            padding: 0 30px;
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 30px;
        }

        /* Dashboard */
        .dashboard {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Containers Box */
        .box {
            background: var(--surface);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        h2 {
            font-size: 1.2rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #fff;
            font-weight: 600;
        }

        h2 .material-icons { color: var(--gold); }

        /* Form Estilizado */
        label { display: block; margin: 15px 0 6px; font-size: 0.8rem; color: var(--text-dim); font-weight: 500; }

        input, select {
            width: 100%;
            padding: 14px;
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: #fff;
            font-size: 0.9rem;
            transition: 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--gold);
            background: rgba(0,0,0,0.4);
        }

        .btn-submit {
            margin-top: 30px;
            padding: 16px;
            width: 100%;
            background: var(--gold-gradient);
            color: #000;
            border: none;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            border-radius: 12px;
            transition: 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-submit:hover { opacity: 0.9; transform: scale(1.02); }

        /* Tabela Profissional */
        .table-responsive { border-radius: 15px; overflow: hidden; border: 1px solid var(--border); }
        
        table { width: 100%; border-collapse: collapse; background: var(--surface); }

        thead { background: rgba(255,255,255,0.03); }

        th { 
            padding: 18px; 
            font-size: 0.75rem; 
            color: var(--gold); 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        td { padding: 18px; border-bottom: 1px solid var(--border); font-size: 0.9rem; }

        tr:last-child td { border-bottom: none; }
        tr:hover { background: rgba(255,255,255,0.02); }

        /* Badges */
        .badge {
            padding: 6px 14px;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
        }

        .badge.pago { background: rgba(0, 200, 83, 0.15); color: var(--success); border: 1px solid var(--success); }
        .badge.pendente { background: rgba(255, 214, 0, 0.15); color: var(--warning); border: 1px solid var(--warning); }

        .btn-delete {
            background: rgba(255, 82, 82, 0.1);
            color: var(--danger);
            border: none;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-delete:hover { background: var(--danger); color: #fff; }

        .logout-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border);
            color: #fff;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        @media (max-width: 900px) {
            .container { grid-template-columns: 1fr; padding: 0 15px; }
            header { padding: 30px 15px; }
            header h1 { font-size: 1.8rem; }
            .logo-container { flex-direction: column; gap: 10px; }
            nav.top-bar { padding: 10px 15px; }
        }

        @media (max-width: 600px) {
            .dashboard { grid-template-columns: 1fr; }
            .box { padding: 20px; border-radius: 12px; }
            h2 { font-size: 1rem; }
            table { font-size: 0.8rem; }
            th, td { padding: 12px; }
            input, select { padding: 12px; font-size: 16px; }
            .btn-submit { padding: 14px; }
            nav.top-bar { flex-direction: column; gap: 10px; text-align: center; }
        }
    </style>
</head>
<body>

<nav class="top-bar">
    <div style="display: flex; gap: 30px; align-items: center;">
        <div style="border-left: 1px solid var(--border); padding-left: 30px; display: flex; align-items: center; gap: 10px; color: var(--text-dim); font-size: 0.85rem;">
            <span class="material-icons">person</span>
            <span id="nomeFuncionario">-</span>
        </div>
    </div>
    <button class="logout-btn" onclick="logout()">Sair</button>
</nav>

<header>
    <div class="logo-container">
        <span class="material-icons" style="font-size: 2.5rem; color: var(--gold);">emoji_events</span>
        <h1>ARCO-IRIS</h1>
    </div>
    <p>Premium Court Management</p>
</header>

<div class="container">

    <section class="box">
        <h2><span class="material-icons">add_box</span> Agendar Horário</h2>
        <form id="formReserva">
            <label>Responsável</label>
            <input type="text" id="nome" placeholder="Nome Completo" required>

            <label>Modalidade</label>
            <select id="esporte" required>
                <option value="">Selecione...</option>
                <option value="Futsal">Futsal</option>
                <option value="Vôlei">Vôlei</option>
            </select>

            <div style="display: flex; gap: 35px;">
                <div style="flex: 1;">
                    <label>Data</label>
                    <input type="date" id="data" required>
                </div>
                <div style="flex: 1;">
                    <label>Valor (R$)</label>
                    <input type="number" id="valor" min="0" step="0.01" placeholder="0,00" required>
                </div>
            </div>

            <div style="display: flex; gap: 35px;">
                <div style="flex: 1;">
                    <label>Horário Início</label>
                    <input type="time" id="inicio" required>
                </div>
                <div style="flex: 1;">
                    <label>Horário Fim</label>
                    <input type="time" id="fim" required>
                </div>
            </div>

            <label>Status Financeiro</label>
            <select id="status" required>
                <option value="Pendente">Aguardando Pagamento</option>
                <option value="Pago">Pago</option>
            </select>

            <button type="submit" class="btn-submit">Confirmar Agendamento</button>
        </form>
    </section>

    <section class="box">
        <h2><span class="material-icons">query_builder</span> Próximos Jogos</h2>
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Responsável & Esporte</th>
                        <th>Período</th>
                        <th>Valor</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="listaReservas"></tbody>
            </table>
        </div>
    </section>

</div>

    <script>
    // Integração com backend: usa token + API em http://localhost:3000
    const token = sessionStorage.getItem('token');
    if (!token) window.location.href = 'login.html';

    const sessao = JSON.parse(sessionStorage.getItem('sessao_usuario') || 'null');
    const elNomeFuncionario = document.getElementById('nomeFuncionario');
    if (elNomeFuncionario) elNomeFuncionario.textContent = sessao ? (sessao.nome || 'Usuário') : '-';

    function logout() {
        sessionStorage.removeItem('sessao_usuario');
        sessionStorage.removeItem('token');
        window.location.href = 'login.html';
    }

    let reservas = [];
    const form = document.getElementById('formReserva');
    const lista = document.getElementById('listaReservas');

    const formatCurrency = (v) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v);
    const formatDate = (ds) => { const [y, m, d] = ds.split('-'); return `${d}/${m}`; };

    async function fetchReservas() {
        try {
            const resp = await fetch('http://localhost:3000/api/reservas', { headers: { 'Authorization': 'Bearer ' + sessionStorage.getItem('token') } });
            if (!resp.ok) throw new Error('Erro ao buscar reservas');
            reservas = await resp.json();
            renderizar();
        } catch (err) {
            console.error(err); alert('Erro ao carregar reservas');
        }
    }

    function renderizar() {
        lista.innerHTML = '';
        let tPago = 0, tPend = 0;
        reservas.sort((a, b) => (a.data + a.inicio).localeCompare(b.data + b.inicio));

        reservas.forEach((r) => {
            if (!r.status) r.status = 'Pendente';
            if (r.status === 'Pago') tPago += r.valor; else tPend += r.valor;

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>
                    <div style="font-weight:700; color:#fff">${r.nome}</div>
                    <div style="font-size:0.75rem; color:var(--gold); letter-spacing:1px; text-transform:uppercase">${r.esporte} • ${formatDate(r.data)}</div>
                </td>
                <td><span style="color:#fff">${r.inicio}</span> <span style="color:var(--text-dim)">às</span> <span style="color:#fff">${r.fim}</span></td>
                <td style="font-weight:600">${formatCurrency(r.valor)}</td>
                <td><span class="badge ${(r.status || 'pendente').toLowerCase()}" onclick="alternarStatus(${r.id})">${r.status}</span></td>
                <td><button class="btn-delete" onclick="remover(${r.id})"><span class="material-icons" style="font-size:18px">delete_outline</span></button></td>
            `;
            lista.appendChild(row);
        });

        if (reservas.length === 0) lista.innerHTML = `<tr><td colspan="5" style="text-align:center; padding: 40px; color: var(--text-dim);">Nenhum registro encontrado.</td></tr>`;
    }

    window.remover = async id => {
        if (!confirm('Deseja apagar este registro?')) return;
        try {
            const resp = await fetch(`http://localhost:3000/api/reservas/${id}`, { method: 'DELETE', headers: { 'Authorization': 'Bearer ' + sessionStorage.getItem('token') } });
            if (!resp.ok) throw new Error('Erro ao apagar');
            fetchReservas();
        } catch (err) { console.error(err); alert('Erro ao apagar'); }
    }

    window.alternarStatus = async id => {
        try {
            const r = reservas.find(x => x.id == id);
            const novo = r.status === 'Pago' ? 'Pendente' : 'Pago';
            const resp = await fetch(`http://localhost:3000/api/reservas/${id}`, { method: 'PUT', headers: { 'Content-Type':'application/json', 'Authorization': 'Bearer ' + sessionStorage.getItem('token') }, body: JSON.stringify({ status: novo }) });
            if (!resp.ok) throw new Error('Erro ao atualizar');
            fetchReservas();
        } catch (err) { console.error(err); alert('Erro ao atualizar status'); }
    }

    form.addEventListener('submit', async e => {
        e.preventDefault();
        const d = {
            nome: document.getElementById('nome').value.trim(),
            esporte: document.getElementById('esporte').value,
            data: document.getElementById('data').value,
            inicio: document.getElementById('inicio').value,
            fim: document.getElementById('fim').value,
            valor: parseFloat(document.getElementById('valor').value),
            status: document.getElementById('status').value
        };

        // Validações
        if (!d.nome || d.nome.length < 3) return alert('Nome deve ter pelo menos 3 caracteres!');
        if (!d.esporte) return alert('Selecione uma modalidade!');
        if (!d.data) return alert('Selecione uma data!');
        if (!d.inicio || !d.fim) return alert('Defina os horários!');
        if (d.valor <= 0) return alert('O valor deve ser maior que zero!');
        if (d.inicio >= d.fim) return alert('Horário inválido. Fim deve ser após início.');

        try {
            const resp = await fetch('http://localhost:3000/api/reservas', { method: 'POST', headers: { 'Content-Type':'application/json', 'Authorization': 'Bearer ' + sessionStorage.getItem('token') }, body: JSON.stringify(d) });
            if (!resp.ok) { const err = await resp.json(); throw new Error(err.error || 'Erro'); }
            form.reset(); document.getElementById('data').valueAsDate = new Date();
            alert('✅ Reserva salva com sucesso!');
            fetchReservas();
        } catch (err) { console.error(err); alert(err.message || 'Erro'); }
    });

    document.getElementById('data').valueAsDate = new Date();
    fetchReservas();
    </script>
</body>
</html>